<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const frame = new Image();
frame.src = "cadre.png";

let userImage = null;

frame.onload = () => {
  redraw();
};

document.getElementById("upload").addEventListener("change", function(e) {
  const img = new Image();
  img.onload = () => {
    userImage = img;
    redraw();
  };
  img.src = URL.createObjectURL(e.target.files[0]);
});

function redraw() {
  if (!frame.complete) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (userImage) {
    ctx.save();
    ctx.beginPath();
    ctx.arc(600, 600, 420, 0, Math.PI * 2);
    ctx.closePath();
    ctx.clip();

    ctx.drawImage(userImage, 180, 180, 840, 840);
    ctx.restore();
  }

  ctx.drawImage(frame, 0, 0, 1200, 1200);
}

function download() {
  const link = document.createElement("a");
  link.download = "photo-profil-auchel.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}
</script>

